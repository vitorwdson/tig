package diff_test

import (
	"bytes"
	"slices"
	"testing"

	"github.com/vitorwdson/tig/internal/diff"
)

var (
	oldBinFile = []byte{
		147, 220, 108, 190, 93, 245, 182, 176, 232, 218, 173, 236, 206, 161, 249, 215, 27, 50, 58, 79,
		111, 70, 232, 6, 107, 107, 235, 113, 200, 8, 149, 85, 124, 105, 86, 167, 12, 212, 62, 198,
		66, 198, 89, 133, 126, 193, 153, 55, 183, 208, 199, 45, 140, 113, 235, 19, 37, 223, 25, 99,
		67, 3, 52, 27, 151, 157, 83, 35, 252, 90, 206, 193, 158, 198, 143, 117, 186, 233, 160, 168,
		27, 202, 182, 11, 33, 210, 143, 179, 253, 12, 36, 150, 41, 50, 127, 73, 132, 27, 92, 143,
		225, 63, 193, 248, 205, 115, 117, 211, 89, 130, 151, 192, 116, 1, 149, 63, 189, 198, 10, 157,
		61, 129, 57, 232, 98, 71, 86, 250, 12, 211, 86, 213, 153, 198, 170, 110, 172, 62, 227, 192,
		221, 156, 46, 114, 21, 175, 251, 64, 69, 117, 61, 222, 190, 140, 105, 76, 140, 132, 68, 128,
		124, 220, 162, 136, 34, 164, 205, 218, 120, 48, 244, 3, 8, 85, 42, 88, 94, 172, 54, 191,
		52, 81, 20, 68, 208, 180, 154, 61, 245, 82, 175, 240, 60, 218, 19, 45, 197, 5, 61, 205,
		125, 205, 126, 101, 15, 81, 43, 18, 30, 80, 107, 187, 180, 110, 57, 138, 47, 161, 26, 83,
		145, 73, 7, 0, 232, 49, 157, 15, 204, 106, 93, 32, 96, 170, 254, 8, 124, 124, 13, 235,
		250, 108, 107, 135, 83, 26, 106, 142, 144, 176, 109, 195, 132, 44, 171, 214, 90, 179, 18, 147,
		243, 110, 75, 19, 45, 66, 67, 191, 217, 74, 37, 87, 214, 34, 191, 233, 38, 65, 216, 203,
		60, 205, 94, 30, 213, 143, 129, 141, 165, 84, 147, 30, 1, 217, 200, 92, 12, 50, 233, 251,
		33, 116, 184, 127, 223, 223, 110, 174, 220, 111, 211, 209, 22, 160, 171, 145, 76, 121, 233, 215,
		150, 53, 79, 237, 21, 228, 77, 71, 47, 131, 67, 25, 38, 70, 133, 175, 34, 41, 125, 123,
		13, 14, 34, 28, 151, 175, 220, 223, 28, 144, 189, 124, 112, 93, 250, 89, 199, 78, 118, 186,
		168, 159, 240, 191, 230, 108, 21, 20, 184, 109, 66, 117, 205, 1, 94, 140, 33, 114, 249, 156,
		94, 29, 141, 237, 165, 6, 128, 195, 213, 3, 173, 185, 133, 223, 143, 20, 190, 224, 76, 1,
		187, 206, 111, 74, 213, 45, 147, 128, 209, 27, 206, 246, 164, 103, 66, 144, 243, 67, 150, 96,
		230, 157, 234, 196, 206, 154, 24, 208, 46, 112, 126, 216, 73, 61, 61, 173, 61, 183, 113, 149,
		94, 130, 143, 83, 179, 188, 16, 223, 126, 105, 144, 71, 166, 230, 33, 167, 215, 71, 81, 93,
		140, 32, 106, 68, 2, 205, 108, 126, 120, 189, 142, 168, 123, 48, 61, 157, 158, 133, 4, 143,
		6, 31, 44, 119, 180, 45, 178, 110, 81, 103, 105, 31, 207, 119, 227, 174, 221, 99, 210, 17,
		168, 198, 47, 86, 154, 118, 193, 35, 104, 113, 12, 138,

		227, 220, 239, 207, 68, 76, 255, 57, 189, 95, 48, 173, 169, 132, 173, 122, 213, 177, 183, 248,
		88, 207, 21, 130, 18, 227, 191, 147, 0, 58, 27, 234, 239, 34, 8, 132, 26, 188, 222, 244,
		106, 208, 192, 188, 155, 167, 35, 80, 114, 110, 207, 219, 47, 221, 49, 125, 55, 199, 174, 221,
		111, 84, 66, 74, 142, 216, 71, 35, 27, 31, 194, 198, 174, 138, 9, 157, 134, 144, 135, 244,
		34, 175, 99, 239, 170, 91, 191, 235, 222, 140, 90, 174, 252, 175, 242, 10, 124, 0, 10, 243,
		113, 17, 94, 67, 223, 153, 204, 211, 16, 147, 0, 227, 239, 175, 36, 221, 108, 222, 210, 102,
		155, 214, 208, 9, 72, 232, 130, 1, 208, 49, 190, 54, 192, 134, 55, 227, 54, 37, 60, 199,
		109, 192, 45, 249, 157, 232, 93, 167, 170, 94, 167, 163, 184, 200, 204, 187, 213, 184, 57, 38,
		26, 87, 252, 5, 237, 56, 115, 127, 115, 17, 130, 198, 181, 163, 12, 68, 59, 118, 77, 104,
		143, 97, 161, 120, 103, 251, 144, 186, 43, 110, 45, 77, 90, 66, 23, 179, 242, 200, 75, 156,
		177, 171, 164, 154, 203, 188, 199, 132, 2, 234, 67, 169, 60, 174, 39, 215, 209, 170, 30, 191,
		113, 28, 141, 164, 217, 164, 187, 54, 43, 5, 188, 188, 211, 29, 216, 32, 184, 182, 68, 236,
		30, 210, 217, 129, 197, 159, 204, 70, 166, 253, 127, 14, 2, 214, 115, 82, 39, 165, 61, 104,
		150, 209, 194, 105, 201, 35, 5, 32, 218, 185, 189, 77, 96, 164, 121, 25, 38, 237, 227, 182,
		47, 59, 33, 67, 209, 83, 184, 171, 25, 26, 133, 226, 129, 183, 253, 103, 255, 214, 230, 111,
		93, 44, 45, 68, 209, 118, 196, 58, 67, 139, 169, 236, 155, 175, 163, 107, 239, 199, 56, 67,
		247, 192, 132, 33, 71, 2, 3, 134, 85, 229, 160, 134, 239, 238, 138, 246, 96, 137, 19, 222,
		32, 136, 94, 95, 42, 151, 31, 198, 94, 181, 232, 180, 26, 150, 114, 55, 202, 80, 19, 243,
		130, 204, 98, 26, 215, 214, 245, 29, 3, 22, 218, 178, 255, 202, 239, 223, 68, 181, 215, 157,
		158, 24, 123, 211, 238, 142, 21, 39, 249, 151, 164, 85, 6, 98, 172, 18, 90, 101, 66, 59,
		249, 8, 191, 187, 210, 95, 130, 237, 16, 162, 4, 175, 187, 206, 5, 214, 74, 224, 60, 181,
		102, 26, 191, 73, 188, 233, 115, 237, 125, 26, 105, 246, 130, 127, 11, 126, 79, 53, 91, 112,
		54, 216, 197, 19, 73, 18, 88, 173, 112, 59, 220, 213, 59, 58, 7, 27, 168, 60, 213, 9,
		70, 229, 171, 83, 169, 26, 157, 6, 231, 47, 118, 47, 102, 216, 154, 64, 156, 197, 148, 90,
		41, 139, 20, 152, 203, 10, 215, 92, 45, 223, 79, 123, 119, 157, 162, 223, 31, 93, 127, 192,
		57, 180, 65, 189, 149, 192, 72, 126, 126, 182, 121, 126,

		252, 20, 31, 190, 10, 7, 106, 144, 105, 246, 187, 40, 221, 7, 155, 167, 12, 50, 31, 219,
		191, 48, 103, 116, 78, 77, 46, 6, 91, 230, 221, 122, 6, 79, 232, 64, 125, 197, 100, 124,
		217, 165, 42, 19, 42, 201, 98, 251, 100, 128, 29, 57, 24, 103, 255, 211, 205, 231, 17, 221,
		250, 136, 202, 20, 139, 41, 76, 198, 252, 189, 253, 169, 229, 29, 116, 248, 131, 93, 12, 107,
		123, 239, 40, 50, 50, 137, 209, 60, 153, 137, 189, 207, 195, 183, 8, 58, 116, 67, 229, 76,
		164, 2, 145, 53, 50, 229, 68, 25, 123, 250, 177, 221, 14, 44, 150, 9, 116, 56, 148, 201,
		228, 165, 236, 74, 128, 217, 225, 63, 131, 177, 218, 215, 102, 90, 16, 100, 60, 122, 235, 219,
		101, 37, 157, 198, 158, 179, 251, 129, 18, 118, 222, 227, 196, 152, 79, 46, 59, 190, 139, 206,
		40, 38, 167, 79, 71, 104, 23, 173, 213, 47, 144, 37, 73, 30, 27, 64, 177, 138, 14, 206,
		239, 84, 145, 124, 189, 102, 190, 192, 237, 218, 162, 150, 33, 161, 182, 2, 248, 119, 126, 213,
		189, 157, 76, 47, 49, 54, 187, 251, 215, 230, 160, 128, 45, 5, 245, 228, 49, 86, 44, 245,
		9, 27, 10, 168, 208, 118, 240, 51, 104, 148, 34, 84, 185, 30, 23, 168, 19, 187, 121, 18,
		208, 130, 198, 23, 30, 231, 165, 225, 127, 99, 125, 53, 228, 135, 131, 10, 23, 130, 12, 17,
		218, 49, 211, 106, 110, 105, 211, 72, 170, 31, 54, 151, 186, 175, 64, 115, 159, 24, 73, 202,
		189, 63, 42, 74, 98, 147, 23, 35, 81, 138, 113, 197, 226, 19, 212, 179, 212, 224, 186, 110,
		251, 46, 226, 56, 97, 218, 29, 9, 146, 194, 84, 222, 232, 70, 18, 50, 124, 81, 237, 253,
		174, 233, 88, 198, 244, 37, 85, 118, 114, 67, 184, 205, 88, 163, 197, 67, 237, 51, 188, 126,
		243, 161, 81, 90, 179, 76, 52, 3, 35, 36, 95, 79, 189, 166, 125, 223, 198, 89, 228, 142,
		123, 193, 83, 255, 18, 105, 15, 14, 58, 149, 50, 215, 189, 127, 76, 105, 143, 161, 72, 72,
		233, 53, 36, 61, 105, 12, 3, 255, 144, 235, 182, 223, 122, 220, 26, 1, 24, 185, 86, 24,
		92, 167, 236, 139, 4, 197, 140, 76, 72, 136, 16, 177, 137, 24, 81, 226, 213, 37, 236, 163,
		145, 7, 71, 197, 193, 155, 43, 12, 100, 139, 238, 151, 34, 145, 25, 210, 84, 206, 145, 192,
		239, 127, 236, 137, 52, 173, 99, 51, 67, 63, 18, 178, 158, 84, 231, 238, 200, 100, 72, 201,
		114, 163, 77, 227, 127, 90, 107, 48, 223, 250, 239, 22, 255, 181, 147, 80, 239, 36, 200, 206,
		79, 147, 4, 62, 112, 53, 209, 65, 241, 90, 3, 90, 173, 131, 250, 121, 74, 17, 108, 53,
		97, 169, 93, 176, 170, 245, 134, 165, 77, 148, 228, 206,

		8, 40, 187, 11, 164, 227, 161, 109, 228, 218, 221, 78, 16, 31, 247, 253, 69, 202, 101, 249,
		162, 72, 28, 73, 4, 193, 255, 197, 153, 150, 60, 209, 191, 70, 247, 37, 224, 132, 128, 77,
		51, 219, 33, 105, 190, 125, 128, 253, 47, 18, 110, 199, 159, 126, 135, 53, 174, 172, 14, 126,
		28, 144, 248, 222, 88, 17, 242, 137, 145, 99, 212, 200, 152, 5, 91, 110, 159, 96, 92, 237,
		17, 17, 123, 246, 115, 33, 246, 180, 80, 54, 179, 181, 222, 218, 248, 57, 93, 204, 148, 20,
		216, 94, 32, 204, 40, 210, 235, 205, 78, 195, 119, 177, 151, 97, 202, 31, 97, 125, 15, 238,
		1, 8, 183, 18, 146, 102, 99, 193, 139, 200, 141, 183, 190, 89, 204, 147, 36, 0, 125, 101,
		184, 146, 0, 107, 237, 66, 52, 115, 48, 132, 148, 241, 199, 66, 147, 103, 145, 119, 46, 127,
		43, 39, 183, 12, 201, 104, 69, 19, 120, 53, 143, 4, 170, 207, 128, 41, 161, 107, 90, 149,
		62, 241, 44, 193, 2, 140, 177, 204, 98, 86, 33, 43, 217, 239, 139, 131, 162, 25, 222, 195,
		205, 31, 159, 37, 243, 235, 210, 175, 228, 119, 1, 51, 89, 192, 35, 72, 145, 102, 19, 218,
		181, 59, 220, 82, 45, 156, 173, 168, 121, 27, 96, 185, 48, 99, 123, 245, 163, 197, 56, 206,
		229, 101, 37, 151, 29, 135, 7, 210, 74, 236, 108, 174, 210, 114, 158, 209, 52, 162, 250, 191,
		104, 125, 153, 184, 238, 45, 216, 132, 202, 169, 52, 168, 154, 184, 207, 201, 181, 167, 1, 87,
		152, 170, 23, 170, 103, 29, 153, 82, 32, 165, 111, 210, 224, 185, 151, 72, 66, 40, 126, 148,
		137, 248, 243, 56, 29, 72, 179, 137, 238, 98, 153, 27, 241, 226, 162, 107, 195, 252, 19, 217,
		205, 123, 143, 158, 185, 231, 114, 228, 222, 102, 79, 8, 215, 136, 39, 191, 235, 127, 79, 65,
		234, 115, 148, 79, 110, 71, 63, 204, 219, 180, 236, 246, 245, 5, 123, 122, 7, 131, 155, 161,
		168, 166, 224, 172, 167, 212, 176, 247, 151, 162, 7, 109, 24, 220, 110, 84, 170, 124, 225, 180,
		131, 224, 144, 178, 232, 5, 226, 111, 67, 253, 126, 217, 84, 189, 65, 80, 123, 70, 179, 202,
		143, 89, 148, 134, 4, 122, 52, 180, 202, 154, 23, 253, 167, 14, 225, 57, 238, 171, 75, 16,
		152, 12, 108, 99, 173, 34, 17, 212, 237, 181, 255, 253, 101, 24, 2, 85, 186, 62, 192, 118,
		235, 207, 77, 121, 97, 161, 63, 117, 38, 185, 139, 34, 60, 210, 61, 106, 64, 64, 239, 170,
		74, 188, 250, 207, 89, 100, 110, 97, 63, 66, 185, 14, 185, 137, 167, 19, 241, 134, 50, 245,
		36, 188, 218, 126, 180, 233, 70, 73, 193, 223, 117, 145, 49, 136, 145, 70, 140, 96, 135, 35,
		100, 155, 236, 38, 172, 43, 146, 236, 226, 146, 238, 177,

		203, 86, 22, 34, 63, 118, 159, 171, 179, 29, 102, 242, 44, 83, 151, 158, 90, 114, 160, 82,
		249, 133, 111, 23, 57, 199, 223, 64, 202, 152, 172, 243, 141, 152, 95, 46, 74, 164, 46, 213,
		174, 35, 187, 34, 92, 48, 69, 33, 190, 253, 170, 109, 230, 177, 139, 123, 163, 31, 46, 92,
		101, 91, 56, 80, 186, 71, 124, 81, 119, 81, 250, 247, 94, 189, 14, 131, 181, 154, 174, 22,
		21, 42, 118, 22, 13, 207, 101, 46, 63, 171, 140, 208, 14, 181, 69, 53, 136, 190, 250, 208,
		154, 106, 193, 238, 224, 213, 68, 163, 219, 187, 21, 140, 160, 62, 33, 1, 71, 2, 102, 200,
		58, 112, 21, 0, 251, 100, 26, 106, 107, 40, 122, 194, 83, 55, 117, 69, 247, 240, 95, 185,
		130, 19, 31, 210, 26, 127, 219, 220, 158, 58, 13, 40, 58, 227, 61, 168, 239, 60, 5, 194,
		111, 221, 32, 27, 27, 97, 182, 67, 217, 97, 11, 229, 26, 220, 73, 202, 96, 175, 241, 22,
		60, 184, 206, 69, 16, 24, 227, 44, 70, 155, 94, 229, 168, 154, 40, 190, 76, 246, 97, 9,
		47, 103, 219, 81, 103, 229, 98, 52, 209, 246, 242, 245, 123, 191, 148, 230, 75, 2, 207, 175,
		202, 187, 74, 117, 37, 87, 231, 2, 95, 124, 146, 177, 86, 58, 180, 181, 59, 34, 51, 70,
		96, 22, 202, 11, 10, 139, 248, 194, 114, 140, 76, 152, 222, 113, 221, 104, 41, 50, 215, 235,
		235, 222, 238, 79, 248, 17, 26, 149, 102, 173, 18, 238, 68, 37, 9, 187, 49, 207, 169, 117,
		107, 3, 245, 101, 154, 149, 216, 221, 169, 250, 245, 116, 186, 128, 77, 197, 68, 82, 225, 16,
		120, 49, 64, 10, 146, 188, 168, 145, 46, 36, 149, 215, 52, 199, 153, 47, 12, 229, 1, 194,
		39, 171, 84, 68, 53, 178, 120, 220, 1, 187, 235, 129, 185, 98, 253, 138, 239, 31, 11, 230,
		60, 4, 181, 190, 188, 226, 133, 98, 126, 86, 135, 48, 41, 95, 229, 75, 143, 13, 41, 193,
		179, 180, 3, 86, 39, 216, 54, 16, 117, 218, 7, 1, 243, 224, 46, 34, 218, 25, 39, 252,
		253, 241, 180, 149, 122, 103, 129, 76, 8, 73, 145, 234, 176, 101, 129, 175, 72, 40, 21, 216,
		65, 77, 214, 235, 224, 39, 31, 174, 209, 52, 10, 160, 89, 111, 7, 54, 156, 58, 51, 99,
		60, 188, 4, 239, 76, 91, 164, 34, 190, 122, 17, 214, 121, 78, 25, 170, 102, 3, 197, 196,
		94, 242, 136, 166, 42, 91, 253, 190, 167, 242, 7, 144, 184, 92, 59, 181, 158, 183, 110, 237,
		73, 77, 72, 166, 242, 104, 39, 60, 50, 45, 104, 198, 103, 215, 130, 33, 234, 227, 175, 63,
		177, 190, 219, 1, 115, 252, 250, 185, 88, 183, 242, 199, 26, 80, 153, 155, 220, 146, 91, 219,
		69, 31, 99, 230, 65, 179, 144, 54, 92, 123, 186, 22,
	}
	newBinFile = []byte{
		// ADDED
		95, 177, 15, 44, 35, 211, 66, 171, 47, 121, 37, 244, 236, 113, 242, 86, 243, 211, 120, 88,
		68, 175, 74, 100, 194, 137, 213, 215, 214, 145, 178, 238, 199, 54, 136, 13, 9, 159, 142, 61,
		125, 39, 63, 181, 139, 232, 16, 156, 129, 182, 161, 171, 134, 217, 247, 206, 202, 154, 76, 250,
		87, 45, 69, 5, 143, 127, 223, 53, 82, 109, 115, 250, 133, 50, 89, 34, 59, 161, 106, 164,
		113, 200, 142, 23, 62, 179, 236, 75, 56, 153, 27, 18, 45, 106, 21, 192, 129, 184, 87, 0,
		26, 89, 197, 213, 57, 237, 210, 164, 239, 198, 89, 228, 156, 175, 27, 221, 104, 78, 233, 68,
		61, 40, 61, 241, 16, 168, 62, 92, 16, 75, 54, 85, 225, 5, 54, 247, 150, 121, 151, 16,
		212, 133, 31, 23, 70, 135, 92, 36, 4, 198, 77, 200, 79, 230, 23, 5, 226, 172, 122, 159,
		137, 81, 226, 171, 97, 145, 197, 134, 153, 103, 123, 73, 43, 9, 82, 145, 139, 188, 217, 68,
		83, 150, 114, 81, 124, 164, 192, 167, 31, 159, 69, 21, 107, 88, 137, 5, 148, 97, 5, 93,
		36, 25, 129, 1, 223, 156, 171, 17, 252, 8, 101, 1, 156, 13, 92, 81, 253, 37, 140, 162,
		20, 97, 0, 54, 140, 238, 187, 232, 38, 211, 166, 3, 222, 56, 174, 194, 52, 125, 92, 206,
		43, 208, 181, 35, 123, 245, 208, 20, 91, 119, 105, 245, 193, 56, 146, 253, 49, 223, 124, 177,
		151, 97, 31, 237, 55, 155, 44, 125, 136, 67, 237, 127, 73, 183, 219, 126, 224, 135, 222, 255,
		229, 74, 181, 22, 117, 46, 127, 231, 66, 109, 78, 44, 109, 235, 43, 177, 70, 132, 44, 37,
		118, 248, 47, 45, 6, 12, 93, 180, 58, 204, 73, 205, 168, 251, 25, 110, 55, 249, 239, 207,
		232, 126, 188, 145, 84, 25, 37, 51, 19, 160, 116, 69, 45, 113, 155, 76, 248, 84, 117, 207,
		23, 234, 76, 49, 39, 78, 108, 115, 128, 201, 169, 199, 37, 244, 67, 93, 202, 227, 192, 98,
		23, 78, 160, 186, 253, 222, 45, 161, 92, 202, 241, 101, 117, 94, 212, 139, 164, 2, 64, 218,
		90, 123, 112, 208, 88, 255, 47, 111, 60, 243, 202, 144, 131, 166, 93, 112, 65, 48, 74, 187,
		226, 245, 157, 233, 117, 20, 182, 161, 230, 11, 160, 1, 75, 217, 147, 103, 42, 69, 218, 94,
		125, 188, 23, 158, 173, 182, 122, 75, 52, 224, 115, 116, 171, 100, 249, 115, 221, 8, 228, 109,
		183, 22, 67, 205, 114, 102, 64, 108, 215, 238, 174, 125, 149, 238, 101, 206, 87, 32, 89, 44,
		207, 24, 233, 29, 161, 161, 46, 173, 229, 63, 32, 174, 209, 43, 119, 123, 99, 200, 99, 163,
		138, 55, 28, 205, 144, 169, 110, 111, 169, 190, 21, 165, 60, 92, 236, 20, 18, 176, 34, 111,
		90, 234, 9, 103, 248, 96, 207, 139, 145, 200, 185, 52,

		147, 220, 108, 190, 93, 245, 182, 176, 232, 218, 173, 236, 206, 161, 249, 215, 27, 50, 58, 79,
		111, 70, 232, 6, 107, 107, 235, 113, 200, 8, 149, 85, 124, 105, 86, 167, 12, 212, 62, 198,
		66, 198, 89, 133, 126, 193, 153, 55, 183, 208, 199, 45, 140, 113, 235, 19, 37, 223, 25, 99,
		67, 3, 52, 27, 151, 157, 83, 35, 252, 90, 206, 193, 158, 198, 143, 117, 186, 233, 160, 168,
		27, 202, 182, 11, 33, 210, 143, 179, 253, 12, 36, 150, 41, 50, 127, 73, 132, 27, 92, 143,
		225, 63, 193, 248, 205, 115, 117, 211, 89, 130, 151, 192, 116, 1, 149, 63, 189, 198, 10, 157,
		61, 129, 57, 232, 98, 71, 86, 250, 12, 211, 86, 213, 153, 198, 170, 110, 172, 62, 227, 192,
		221, 156, 46, 114, 21, 175, 251, 64, 69, 117, 61, 222, 190, 140, 105, 76, 140, 132, 68, 128,
		124, 220, 162, 136, 34, 164, 205, 218, 120, 48, 244, 3, 8, 85, 42, 88, 94, 172, 54, 191,
		52, 81, 20, 68, 208, 180, 154, 61, 245, 82, 175, 240, 60, 218, 19, 45, 197, 5, 61, 205,
		125, 205, 126, 101, 15, 81, 43, 18, 30, 80, 107, 187, 180, 110, 57, 138, 47, 161, 26, 83,
		145, 73, 7, 0, 232, 49, 157, 15, 204, 106, 93, 32, 96, 170, 254, 8, 124, 124, 13, 235,
		250, 108, 107, 135, 83, 26, 106, 142, 144, 176, 109, 195, 132, 44, 171, 214, 90, 179, 18, 147,
		243, 110, 75, 19, 45, 66, 67, 191, 217, 74, 37, 87, 214, 34, 191, 233, 38, 65, 216, 203,
		60, 205, 94, 30, 213, 143, 129, 141, 165, 84, 147, 30, 1, 217, 200, 92, 12, 50, 233, 251,
		33, 116, 184, 127, 223, 223, 110, 174, 220, 111, 211, 209, 22, 160, 171, 145, 76, 121, 233, 215,
		150, 53, 79, 237, 21, 228, 77, 71, 47, 131, 67, 25, 38, 70, 133, 175, 34, 41, 125, 123,
		13, 14, 34, 28, 151, 175, 220, 223, 28, 144, 189, 124, 112, 93, 250, 89, 199, 78, 118, 186,
		168, 159, 240, 191, 230, 108, 21, 20, 184, 109, 66, 117, 205, 1, 94, 140, 33, 114, 249, 156,
		94, 29, 141, 237, 165, 6, 128, 195, 213, 3, 173, 185, 133, 223, 143, 20, 190, 224, 76, 1,
		187, 206, 111, 74, 213, 45, 147, 128, 209, 27, 206, 246, 164, 103, 66, 144, 243, 67, 150, 96,
		230, 157, 234, 196, 206, 154, 24, 208, 46, 112, 126, 216, 73, 61, 61, 173, 61, 183, 113, 149,
		94, 130, 143, 83, 179, 188, 16, 223, 126, 105, 144, 71, 166, 230, 33, 167, 215, 71, 81, 93,
		140, 32, 106, 68, 2, 205, 108, 126, 120, 189, 142, 168, 123, 48, 61, 157, 158, 133, 4, 143,
		6, 31, 44, 119, 180, 45, 178, 110, 81, 103, 105, 31, 207, 119, 227, 174, 221, 99, 210, 17,
		168, 198, 47, 86, 154, 118, 193, 35, 104, 113, 12, 138,

		// DELETED
		// DELETED

		8, 40, 187, 11, 164, 227, 161, 109, 228, 218, 221, 78, 16, 31, 247, 253, 69, 202, 101, 249,
		162, 72, 28, 73, 4, 193, 255, 197, 153, 150, 60, 209, 191, 70, 247, 37, 224, 132, 128, 77,
		51, 219, 33, 105, 190, 125, 128, 253, 47, 18, 110, 199, 159, 126, 135, 53, 174, 172, 14, 126,
		28, 144, 248, 222, 88, 17, 242, 137, 145, 99, 212, 200, 152, 5, 91, 110, 159, 96, 92, 237,
		17, 17, 123, 246, 115, 33, 246, 180, 80, 54, 179, 181, 222, 218, 248, 57, 93, 204, 148, 20,
		216, 94, 32, 204, 40, 210, 235, 205, 78, 195, 119, 177, 151, 97, 202, 31, 97, 125, 15, 238,
		1, 8, 183, 18, 146, 102, 99, 193, 139, 200, 141, 183, 190, 89, 204, 147, 36, 0, 125, 101,
		184, 146, 0, 107, 237, 66, 52, 115, 48, 132, 148, 241, 199, 66, 147, 103, 145, 119, 46, 127,
		43, 39, 183, 12, 201, 104, 69, 19, 120, 53, 143, 4, 170, 207, 128, 41, 161, 107, 90, 149,
		62, 241, 44, 193, 2, 140, 177, 204, 98, 86, 33, 43, 217, 239, 139, 131, 162, 25, 222, 195,
		205, 31, 159, 37, 243, 235, 210, 175, 228, 119, 1, 51, 89, 192, 35, 72, 145, 102, 19, 218,
		181, 59, 220, 82, 45, 156, 173, 168, 121, 27, 96, 185, 48, 99, 123, 245, 163, 197, 56, 206,
		229, 101, 37, 151, 29, 135, 7, 210, 74, 236, 108, 174, 210, 114, 158, 209, 52, 162, 250, 191,
		104, 125, 153, 184, 238, 45, 216, 132, 202, 169, 52, 168, 154, 184, 207, 201, 181, 167, 1, 87,
		152, 170, 23, 170, 103, 29, 153, 82, 32, 165, 111, 210, 224, 185, 151, 72, 66, 40, 126, 148,
		137, 248, 243, 56, 29, 72, 179, 137, 238, 98, 153, 27, 241, 226, 162, 107, 195, 252, 19, 217,
		205, 123, 143, 158, 185, 231, 114, 228, 222, 102, 79, 8, 215, 136, 39, 191, 235, 127, 79, 65,
		234, 115, 148, 79, 110, 71, 63, 204, 219, 180, 236, 246, 245, 5, 123, 122, 7, 131, 155, 161,
		168, 166, 224, 172, 167, 212, 176, 247, 151, 162, 7, 109, 24, 220, 110, 84, 170, 124, 225, 180,
		131, 224, 144, 178, 232, 5, 226, 111, 67, 253, 126, 217, 84, 189, 65, 80, 123, 70, 179, 202,
		143, 89, 148, 134, 4, 122, 52, 180, 202, 154, 23, 253, 167, 14, 225, 57, 238, 171, 75, 16,
		152, 12, 108, 99, 173, 34, 17, 212, 237, 181, 255, 253, 101, 24, 2, 85, 186, 62, 192, 118,
		235, 207, 77, 121, 97, 161, 63, 117, 38, 185, 139, 34, 60, 210, 61, 106, 64, 64, 239, 170,
		74, 188, 250, 207, 89, 100, 110, 97, 63, 66, 185, 14, 185, 137, 167, 19, 241, 134, 50, 245,
		36, 188, 218, 126, 180, 233, 70, 73, 193, 223, 117, 145, 49, 136, 145, 70, 140, 96, 135, 35,
		100, 155, 236, 38, 172, 43, 146, 236, 226, 146, 238, 177,

		// REPLACE
		203, 86, 22, 34, 63, 118, 159, 171, 179, 29, 102, 242, 44, 83, 151, 158, 90, 114, 160, 82,
		249, 133, 111, 23, 57, 199, 223, 64, 202, 152, 172, 243, 141, 152, 95, 46, 74, 164, 46, 213,
		174, 35, 187, 34, 92, 48, 69, 33, 190, 253, 170, 109, 230, 177, 139, 123, 163, 31, 46, 92,
		101, 91, 56, 80, 186, 71, 124, 81, 119, 81, 250, 247, 94, 189, 14, 131, 181, 154, 174, 22,
		21, 42, 118, 22, 13, 207, 101, 46, 63, 171, 140, 208, 14, 181, 69, 53, 136, 190, 250, 208,
		154, 106, 193, 238, 224, 213, 68, 163, 219, 187, 21, 140, 160, 62, 33, 1, 71, 2, 102, 200,
		58, 112, 21, 0, 251, 100, 26, 106, 107, 40, 122, 194, 83, 55, 117, 69, 247, 240, 95, 185,
		130, 19, 31, 210, 26, 127, 219, 220, 158, 58, 13, 40, 58, 227, 61, 168, 239, 60, 5, 194,
		111, 221, 32, 27, 27, 97, 182, 67, 217, 97, 11, 229, 26, 220, 73, 202, 96, 175, 241, 22,
		60, 184, 206, 69, 16, 24, 227, 44, 70, 155, 94, 229, 168, 154, 40, 190, 76, 246, 97, 9,
		47, 103, 219, 81, 103, 229, 98, 52, 209, 246, 242, 245, 123, 191, 148, 230, 75, 2, 207, 175,
		202, 187, 74, 117, 37, 87, 231, 2, 95, 124, 146, 177, 86, 58, 180, 181, 59, 34, 51, 70,
		96, 22, 202, 11, 10, 139, 248, 194, 114, 140, 76, 152, 222, 113, 221, 104, 41, 50, 215, 235,
		235, 222, 238, 79, 248, 17, 26, 149, 102, 173, 18, 238, 68, 37, 9, 187, 49, 207, 169, 117,
		107, 3, 245, 101, 154, 149, 216, 221, 169, 250, 245, 116, 186, 128, 77, 197, 68, 82, 225, 16,
		120, 49, 64, 10, 146, 188, 168, 145, 46, 36, 149, 215, 52, 199, 153, 47, 12, 229, 1, 194,
		39, 171, 84, 68, 53, 178, 120, 220, 1, 187, 235, 129, 185, 98, 253, 138, 239, 31, 11, 230,
		60, 4, 181, 190, 188, 226, 133, 98, 126, 86, 135, 48, 41, 95, 229, 75, 143, 13, 41, 193,
		179, 180, 3, 86, 39, 216, 54, 16, 117, 218, 7, 1, 243, 224, 46, 34, 218, 25, 39, 252,
		253, 241, 180, 149, 122, 103, 129, 76, 8, 73, 145, 234, 176, 101, 129, 175, 72, 40, 21, 216,
		65, 79, 214, 235, 224, 39, 31, 174, 209, 52, 10, 160, 89, 111, 7, 54, 156, 58, 51, 99,
		60, 188, 4, 239, 76, 91, 164, 34, 190, 122, 17, 214, 121, 78, 25, 170, 102, 3, 197, 196,
		94, 242, 136, 166, 42, 91, 253, 190, 167, 242, 7, 144, 184, 92, 59, 181, 158, 183, 110, 237,
		73, 77, 72, 166, 242, 104, 39, 60, 50, 45, 104, 198, 103, 215, 130, 33, 234, 227, 175, 63,
		177, 190, 219, 1, 115, 252, 250, 185, 88, 183, 242, 199, 26, 80, 153, 155, 220, 146, 91, 219,
		69, 31, 99, 230, 65, 179, 144, 54, 92, 123, 186, 22,
	}
)

func TestBinaryDiff(t *testing.T) {
	diffs, err := diff.BinaryFileDiff(bytes.NewReader(oldBinFile), bytes.NewReader(newBinFile))
	if err != nil {
		t.Fatal("generating text file diffs errored: ", err)
	}

	expected := []diff.Diff{
		{Block: 0, Type: diff.ADD, Content: newBinFile[0:512]},
		{Block: 1, Type: diff.REMOVE, Content: oldBinFile[512:1024]},
		{Block: 2, Type: diff.REMOVE, Content: oldBinFile[1024:1536]},
		{Block: 3, Type: diff.REPLACE, Content: newBinFile[1536:2048]},
	}

	if len(expected) != len(diffs) {
		t.Fatalf("expected %v, but got %v", expected, diffs)
	}

	for i := range expected {
		e := expected[i]
		d := diffs[i]

		if e.Block != d.Block || e.Type != d.Type || !slices.Equal(e.Content, d.Content) {
			t.Fatalf(
				"expected block=%d type=%d\n%s\n\ngot block=%d type=%d\n%s",
				e.Block,
				e.Type,
				string(e.Content),
				d.Block,
				d.Type,
				string(d.Content),
			)
		}
	}
}
